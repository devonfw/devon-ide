if [ -n "${SOFTWARE_PATH}" ]
then
  # "remove" previous IDE from $PATH
  export PATH=`echo $PATH | sed "s~${SOFTWARE_PATH}[^:]*::*~~g"`
fi

# load and setup configuration
source "${PWD}/scripts/variables"
if [ -f "${PWD}/conf/variables" ]
then
  source "${PWD}/conf/variables"
fi
if [ -f "${SETTINGS_PATH}/ide-properties" ]
then
  source "${SETTINGS_PATH}/ide-properties"
fi
if [ -z "${WORKSPACE}" ]
then
  export WORKSPACE=main
fi
export DEVON_IDE_HOME=${PWD}
export WORKSPACE_PATH=${PWD}/workspaces/${WORKSPACE}
export SOFTWARE_PATH=${PWD}/software
export IDE_CONFIGURATOR=devon-ide-configurator-${devon_ide_version}.jar

# copy defaults
if [ ! -e "$PWD/conf/variables" ]
then
  cp "${SETTINGS_PATH}/devon/variables" "${PWD}/conf/"
fi
if [ ! -e "$PWD/conf/variables-customized" ]
then
  cp "${SETTINGS_PATH}/devon/variables-customized" "${PWD}/conf/"
fi

# Setup path
for SOFTWARE_FOLDER in ${SOFTWARE_PATH}/*
do
  if [ -d "${SOFTWARE_FOLDER}/bin" ]
  then
    PATH="${SOFTWARE_FOLDER}/bin:${PATH}"
  else
    PATH="${SOFTWARE_FOLDER}:${PATH}"
  fi
  # Load custom configuration of software
  if [ -e "${SOFTWARE_FOLDER}/ide-config" ]
  then
    source "${SOFTWARE_FOLDER}/ide-config"
  fi
done

# Modularization: run all linux/mac/bsd scripts from scripts/init/
# To customize devon-ide you may add your own scripts in this folder
for SCRIPT in ${PWD}/scripts/init/*
do
  if [ "${SCRIPT##*.}" != "bat" ]
  then
    source ${SCRIPT}
  fi
done

# load user settings late so variables like M2_REPO can be overriden
if [ -f "${PWD}/conf/variables-customized" ]
then
  source "${PWD}/conf/variables-customized"
fi

export PATH

echo "IDE environment has been initialized."
